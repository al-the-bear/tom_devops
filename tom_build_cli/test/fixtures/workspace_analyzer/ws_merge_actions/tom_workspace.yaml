# Test fixture: Workspace with actions to be merged with projects
name: ws_merge_actions

actions:
  build:
    skip-types: [vscode_extension]
    default:
      commands:
        - dart analyze lib
        - dart run build_runner build --delete-conflicting-outputs
    dart_package:
      commands:
        - dart analyze lib test
        - dart run build_runner build --delete-conflicting-outputs

  test:
    default:
      commands:
        - dart test
    flutter_app:
      commands:
        - flutter test

  compile:
    applies-to-types: [dart_console]
    default:
      commands:
        - dart compile exe bin/main.dart -o bin/$VAL{name}
      output: bin/

  run:
    default:
      commands:
        - dart run
    flutter_app:
      commands:
        - flutter run

  deploy:
    skip-types: [dart_package, vscode_extension]
    default:
      commands:
        - echo "Deployment not configured"

cross-compilation:
  all-targets:
    - darwin-x64
    - darwin-arm64
    - linux-x64
    - linux-arm64
    - win32-x64
  build-on:
    darwin-arm64:
      targets: [darwin-arm64, linux-x64, linux-arm64]
    darwin-x64:
      targets: [darwin-x64, linux-x64, linux-arm64]
    linux-x64:
      targets: [linux-x64, linux-arm64]

environment-mode-definitions:
  default:
    description: Default environment
  local:
    description: Local development
    working-dir: .
    variables:
      DEBUG: true
  prod:
    description: Production
    variables:
      DEBUG: false

deployment-mode-definitions:
  default:
    strategy: rolling
  none:
    description: No deployment
  kubernetes:
    description: Kubernetes deployment
    namespace: default
    replicas: 1
