# Tom Build Configuration for Build Tool

versioner:

cleanup:
  - '**/version.versioner.dart'

compiler:
  compiles:
    # macOS ARM64 - compile for self + all Linux targets
    - commandline:
        - mkdir -p $HOME/.tom/bin/${target-platform-vs}
        - dart compile exe ${file} --target-os=${target-os} -o $HOME/.tom/bin/${target-platform-vs}/${file.name}
      files:
        - bin/deploy.dart
        - bin/doc_scanner.dart
        - bin/docspecs.dart
        - bin/md2latex.dart
        - bin/md2pdf.dart
        - bin/ws_analyzer.dart
        - bin/ws_prepper.dart
      targets: [darwin-arm64, linux-x64, linux-arm64, linux-armhf]
      platforms: [darwin-arm64]
    
    # Other platforms - compile for self only
    - commandline:
        - mkdir -p $HOME/.tom/bin/${target-platform-vs}
        - dart compile exe ${file} -o $HOME/.tom/bin/${target-platform-vs}/${file.name}
      files:
        - bin/deploy.dart
        - bin/doc_scanner.dart
        - bin/docspecs.dart
        - bin/md2latex.dart
        - bin/md2pdf.dart
        - bin/ws_analyzer.dart
        - bin/ws_prepper.dart
      platforms: [darwin-x64, linux-*, win32-*]

  postcompile:
    # Make binaries executable on Unix-like systems
    - commandline:
        - chmod -R +x $HOME/.tom/bin/${current-platform-vs}/
      platforms: [macos, linux]
