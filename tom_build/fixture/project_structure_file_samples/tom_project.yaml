# tom_uam_server/tom_project.yaml

# Build dependencies (same structure as workspace)
build-after:
  - tom_uam_shared
  - tom_core_kernel

action-order:
  deploy-after: [tom_uam_shared]

# Features (override auto-detection)
features:
  publishable: false
  has-docker: true

# Cross-compilation (override workspace settings)
cross-compilation:
  all-targets: [linux-x64, linux-arm64]
  build-on:
    linux-x64:
      targets: [linux-x64, linux-arm64]

# Binary output folder
binaries: bin/

# Executables to compile (replaces compilation-targets)
executables:
  - source: bin/server.dart
    output: server

# Action-specific mode overrides
action-mode-definitions:
  build:
    environment: local
    execution: docker
    deployment: none
    publishing: development
  deploy:
    environment: prod
    execution: cloud
    cloud-provider: aws
    deployment: kubernetes
    publishing: release

# Mode type definition overrides (deep-merge with workspace)
execution-mode-definitions:
  docker:
    image: tom-uam-server
    dockerfile: Dockerfile
    compose-file: docker-compose.yml

deployment-mode-definitions:
  kubernetes:
    dockerfile: Dockerfile
    target-platforms: [linux/amd64, linux/arm64]

# Action overrides (same structure as workspace)
actions:
  build:
    default:
      pre-commands:
        - echo "Building server..."
      commands:
        - dart analyze lib bin test
        - dart test
        - dart compile exe bin/server.dart -o bin/server
      post-commands:
        - echo "Server build complete"
  deploy:
    default:
      pre-commands:
        - echo "Deploying server..."
      commands:
        - docker-compose up -d
      post-commands:
        - echo "Server deployed"

# Metadata file content (auto-inserted from pubspec.yaml)
pubspec-yaml:
  name: tom_uam_server
  version: 1.0.0
  homepage: https://github.com/example/tom_uam_server

# Custom tags (passed through to tom_master*.yaml)
server-config:
  port: 8080
  max-connections: 100
